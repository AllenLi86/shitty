<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>çæ°ç‹ - é›™äººéŠæˆ²</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }
    
    .login-section {
      display: flex;
      justify-content: space-around;
      margin-bottom: 30px;
    }
    
    .player-login {
      text-align: center;
      padding: 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      min-width: 200px;
    }
    
    .player-login.filled {
      background-color: #e8f5e8;
      border-color: #4CAF50;
    }
    
    .player-login h3 {
      margin-top: 0;
      color: #666;
    }
    
    input[type="text"] {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin: 10px 0;
      width: 150px;
    }
    
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .game-area {
      display: none;
      text-align: center;
    }
    
    .status {
      font-size: 18px;
      margin: 20px 0;
      padding: 15px;
      background-color: #e3f2fd;
      border-radius: 8px;
    }
    
    .question {
      font-size: 20px;
      font-weight: bold;
      margin: 20px 0;
      padding: 20px;
      background-color: #fff3e0;
      border-radius: 8px;
      border-left: 4px solid #ff9800;
    }
    
    .explanation {
      font-size: 16px;
      margin: 20px 0;
      padding: 15px;
      background-color: #f3e5f5;
      border-radius: 8px;
      border-left: 4px solid #9c27b0;
    }
    
    .buttons {
      margin: 30px 0;
    }
    
    .buttons button {
      margin: 0 10px;
      padding: 15px 30px;
      font-size: 16px;
    }
    
    .guess-button {
      background-color: #2196F3;
    }
    
    .guess-button:hover {
      background-color: #1976D2;
    }
    
    .waiting {
      color: #666;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘‘ çæ°ç‹ï¼ˆé›™äººåŒæ­¥éŠæˆ²ï¼‰v0.2.0</h1>

    <div id="login">
      <div class="login-section">
        <div class="player-login" id="playerA-section">
          <h3>ç©å®¶ A</h3>
          <input type="text" id="playerA-name" placeholder="ç©å®¶Açš„åå­—" />
          <br>
          <button onclick="joinAsPlayer('A')">åŠ å…¥ç‚ºç©å®¶A</button>
          <div id="playerA-status"></div>
        </div>
        
        <div class="player-login" id="playerB-section">
          <h3>ç©å®¶ B</h3>
          <input type="text" id="playerB-name" placeholder="ç©å®¶Bçš„åå­—" />
          <br>
          <button onclick="joinAsPlayer('B')">åŠ å…¥ç‚ºç©å®¶B</button>
          <div id="playerB-status"></div>
        </div>
      </div>
      
      <div style="text-align: center;">
        <button id="startGame" onclick="startGame()" disabled>é–‹å§‹éŠæˆ²</button>
      </div>
    </div>

    <div id="game-area" class="game-area">
      <div id="status" class="status"></div>
      <div id="question" class="question"></div>
      <div id="explanation" class="explanation" style="display: none;"></div>
      <div id="buttons" class="buttons"></div>
      <div id="waiting" class="waiting" style="display: none;">ç­‰å¾…å°æ–¹è¡Œå‹•...</div>
    </div>
  </div>

  <!-- Firebase CDN ç‰ˆæœ¬ï¼ˆcompatï¼‰ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <script>
    // Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyB95BnsfKtB__X6K7KbPCT0zng4eofZ3Ks",
      authDomain: "shitty-24b2f.firebaseapp.com",
      databaseURL: "https://shitty-24b2f-default-rtdb.firebaseio.com",
      projectId: "shitty-24b2f",
      storageBucket: "shitty-24b2f.appspot.com",
      messagingSenderId: "370223390160",
      appId: "1:370223390160:web:8be6cba5345de0f73eadd5"
    };

    // åˆå§‹åŒ– Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // éŠæˆ²ç‹€æ…‹
    let currentPlayer = null;
    let gameState = null;

    // æ¸¬è©¦é¡Œç›®å’Œè§£èªª
    const testQuestions = [
      {
        question: "ç‚ºä»€éº¼ä¼éµä¸æœƒé£›ï¼Ÿ",
        explanation: "ä¼éµçš„ç¥–å…ˆåŸæœ¬æœƒé£›ï¼Œä½†ç‚ºäº†é©æ‡‰æ°´ä¸­ç”Ÿæ´»ï¼Œç¿…è†€æ¼”åŒ–æˆäº†æ›´é©åˆæ¸¸æ³³çš„é°­ç‹€è‚¢ã€‚ç‰ å€‘çš„éª¨éª¼ä¹Ÿè®Šå¾—æ›´é‡ï¼Œä»¥ä¾¿åœ¨æ°´ä¸­ä¿æŒç©©å®šã€‚"
      },
      {
        question: "ç‚ºä»€éº¼å¤©ç©ºæ˜¯è—è‰²çš„ï¼Ÿ",
        explanation: "é™½å…‰é€²å…¥å¤§æ°£å±¤æ™‚ï¼Œè—å…‰çš„æ³¢é•·è¼ƒçŸ­ï¼Œæ›´å®¹æ˜“è¢«ç©ºæ°£åˆ†å­æ•£å°„ï¼Œæ‰€ä»¥æˆ‘å€‘çœ‹åˆ°çš„å¤©ç©ºå‘ˆç¾è—è‰²ã€‚é€™ç¨®ç¾è±¡å«åšç‘åˆ©æ•£å°„ã€‚"
      },
      {
        question: "ç‚ºä»€éº¼æ´‹è”¥æœƒè®“äººæµæ·šï¼Ÿ",
        explanation: "æ´‹è”¥è¢«åˆ‡é–‹æ™‚æœƒé‡‹æ”¾å«ç¡«åŒ–åˆç‰©ï¼Œé€™äº›åŒ–åˆç‰©èˆ‡çœ¼ç›æ¥è§¸æ™‚æœƒå½¢æˆç¡«é…¸ï¼Œåˆºæ¿€æ·šè…ºåˆ†æ³Œçœ¼æ·šä¾†æ²–æ´—åˆºæ¿€ç‰©ã€‚"
      }
    ];

    // åŠ å…¥éŠæˆ²
    function joinAsPlayer(player) {
      const nameInput = document.getElementById(`player${player}-name`);
      const name = nameInput.value.trim();
      
      if (!name) {
        alert("è«‹è¼¸å…¥åç¨±");
        return;
      }

      currentPlayer = player;
      
      // æ›´æ–°Firebaseä¸­çš„ç©å®¶è³‡è¨Š
      db.ref(`game/player${player}`).set({
        name: name,
        joinedAt: Date.now()
      });

      // æ›´æ–°UI
      document.getElementById(`player${player}-section`).classList.add('filled');
      document.getElementById(`player${player}-status`).innerHTML = `âœ… ${name} å·²åŠ å…¥`;
      nameInput.disabled = true;
      
      // ç›£è½éŠæˆ²ç‹€æ…‹
      listenToGameState();
    }

    // ç›£è½éŠæˆ²ç‹€æ…‹
    function listenToGameState() {
      db.ref('game').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        // æª¢æŸ¥å…©å€‹ç©å®¶æ˜¯å¦éƒ½å·²åŠ å…¥
        if (data.playerA && data.playerB) {
          document.getElementById('startGame').disabled = false;
          
          // æ›´æ–°ç©å®¶ç‹€æ…‹é¡¯ç¤º
          if (data.playerA) {
            document.getElementById('playerA-section').classList.add('filled');
            document.getElementById('playerA-status').innerHTML = `âœ… ${data.playerA.name} å·²åŠ å…¥`;
          }
          if (data.playerB) {
            document.getElementById('playerB-section').classList.add('filled');
            document.getElementById('playerB-status').innerHTML = `âœ… ${data.playerB.name} å·²åŠ å…¥`;
          }
        }

        // å¦‚æœéŠæˆ²å·²é–‹å§‹
        if (data.gameStarted && currentPlayer) {
          gameState = data;
          showGameArea();
        }
      });
    }

    // é–‹å§‹éŠæˆ²
    function startGame() {
      if (!currentPlayer) {
        alert("è«‹å…ˆé¸æ“‡ç©å®¶èº«ä»½");
        return;
      }

      // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
      const initialGameState = {
        gameStarted: true,
        round: 1,
        currentGuesser: 'A', // Aå…ˆç•¶æƒ³æƒ³
        currentQuestion: 0,
        playerBRole: Math.random() < 0.5 ? 'honest' : 'liar' // éš¨æ©Ÿåˆ†é…Bçš„è§’è‰²
      };

      db.ref('game').update(initialGameState);
    }

    // é¡¯ç¤ºéŠæˆ²å€åŸŸ
    function showGameArea() {
      document.getElementById('login').style.display = 'none';
      document.getElementById('game-area').style.display = 'block';
      
      updateGameDisplay();
    }

    // æ›´æ–°éŠæˆ²é¡¯ç¤º
    function updateGameDisplay() {
      const question = testQuestions[gameState.currentQuestion];
      const isGuesser = currentPlayer === gameState.currentGuesser;
      const isPlayerB = currentPlayer === 'B';
      const playerBRole = gameState.playerBRole;

      // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
      const statusEl = document.getElementById('status');
      if (isGuesser) {
        statusEl.innerHTML = `ğŸ¤” ä½ æ˜¯æƒ³æƒ³ï¼è«‹çŒœæ¸¬å°æ–¹æ˜¯è€å¯¦äººé‚„æ˜¯çæ°äºº`;
      } else {
        const roleText = playerBRole === 'honest' ? 'è€å¯¦äºº' : 'çæ°äºº';
        statusEl.innerHTML = `ğŸ­ ä½ æ˜¯${roleText}ï¼`;
      }

      // é¡¯ç¤ºé¡Œç›®
      document.getElementById('question').innerHTML = `é¡Œç›®ï¼š${question.question}`;

      // æ ¹æ“šè§’è‰²é¡¯ç¤ºä¸åŒå…§å®¹
      const explanationEl = document.getElementById('explanation');
      const buttonsEl = document.getElementById('buttons');
      const waitingEl = document.getElementById('waiting');

      if (isGuesser) {
        // æƒ³æƒ³åªçœ‹åˆ°é¡Œç›®å’ŒçŒœæ¸¬æŒ‰éˆ•
        explanationEl.style.display = 'none';
        buttonsEl.innerHTML = `
          <button class="guess-button" onclick="makeGuess('honest')">ä»–æ˜¯è€å¯¦äºº</button>
          <button class="guess-button" onclick="makeGuess('liar')">ä»–æ˜¯çæ°äºº</button>
        `;
        waitingEl.style.display = 'none';
      } else if (isPlayerB) {
        // ç©å®¶Bæ ¹æ“šè§’è‰²é¡¯ç¤ºä¸åŒå…§å®¹
        if (playerBRole === 'honest') {
          // è€å¯¦äººçœ‹åˆ°è§£èªª
          explanationEl.innerHTML = `è§£èªªï¼š${question.explanation}`;
          explanationEl.style.display = 'block';
        } else {
          // çæ°äººåªçœ‹åˆ°é¡Œç›®
          explanationEl.style.display = 'none';
        }
        buttonsEl.innerHTML = '';
        waitingEl.style.display = 'block';
        waitingEl.innerHTML = 'ç­‰å¾…æƒ³æƒ³åšå‡ºçŒœæ¸¬...';
      }
    }

    // åšå‡ºçŒœæ¸¬
    function makeGuess(guess) {
      const correct = guess === gameState.playerBRole;
      
      // æ›´æ–°éŠæˆ²ç‹€æ…‹
      db.ref('game').update({
        lastGuess: guess,
        guessResult: correct ? 'correct' : 'wrong',
        round: gameState.round + 1,
        currentGuesser: gameState.currentGuesser === 'A' ? 'B' : 'A', // è¼ªæ›
        currentQuestion: (gameState.currentQuestion + 1) % testQuestions.length,
        playerBRole: Math.random() < 0.5 ? 'honest' : 'liar' // é‡æ–°éš¨æ©Ÿåˆ†é…
      });

      // é¡¯ç¤ºçµæœ
      const resultText = correct ? 'âœ… çŒœå°äº†ï¼' : 'âŒ çŒœéŒ¯äº†ï¼';
      const roleText = gameState.playerBRole === 'honest' ? 'è€å¯¦äºº' : 'çæ°äºº';
      alert(`${resultText}\nå°æ–¹å…¶å¯¦æ˜¯${roleText}`);
    }

    // ç¶å®šåˆ° window
    window.joinAsPlayer = joinAsPlayer;
    window.startGame = startGame;
    window.makeGuess = makeGuess;
  </script>
</body>
</html>