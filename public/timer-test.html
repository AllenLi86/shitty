<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>計時器測試</title>
    <style>
        /* 計時器樣式 */
        .timer-display {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
            z-index: 10;
        }

        .timer-circle {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 2;
        }

        .timer-number {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b6b;
            line-height: 1;
        }

        .timer-label {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }

        .timer-ring {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotate(-90deg);
            z-index: 1;
        }

        .timer-ring circle {
            stroke-dasharray: 264;
            stroke-dashoffset: 264;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
            fill: none;
            stroke-width: 6;
            stroke: #ff6b6b;
        }

        .timer-warning .timer-number {
            color: #ff9800;
            animation: timerPulse 1s infinite;
        }

        .timer-critical .timer-number {
            color: #f44336;
            animation: timerPulse 0.5s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* 解答區樣式 */
        .explanation {
            background: #f0f0f0;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
        }

        .explanation.timer-hidden {
            display: none !important;
        }

        .explanation.timer-dimmed {
            opacity: 0.3 !important;
            filter: blur(1px) !important;
            pointer-events: none !important;
            background-color: #f0f0f0 !important;
            color: #999 !important;
            transition: all 0.3s ease !important;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>計時器測試</h1>
    
    <div>
        <label>計時秒數：</label>
        <input type="number" id="timer-input" value="5" min="1" max="60">
        <button onclick="startTest()">開始測試</button>
        <button onclick="stopTest()">停止測試</button>
    </div>

    <!-- 計時器顯示 -->
    <div id="timer-display" class="timer-display" style="display: none;">
        <div class="timer-circle">
            <div class="timer-text">
                <div class="timer-number" id="timer-number">5</div>
                <div class="timer-label">秒</div>
            </div>
            <svg class="timer-ring" width="100" height="100">
                <circle id="timer-circle" cx="50" cy="50" r="42" stroke="#ff6b6b" stroke-width="6" fill="none" />
            </svg>
        </div>
    </div>

    <!-- 測試解答區 -->
    <div id="explanation" class="explanation">
        這是測試解答區域。時間到後，這裡應該會隱藏或變淡。
    </div>

    <div>
        <label>效果類型：</label>
        <select id="effect-type">
            <option value="hide">隱藏解答</option>
            <option value="dim">解答變淡</option>
        </select>
    </div>

    <script>
        let testTimer = null;

        function startTest() {
            console.log('🔥 開始測試計時器');
            
            // 獲取設定
            const seconds = parseInt(document.getElementById('timer-input').value) || 5;
            const effect = document.getElementById('effect-type').value;
            
            console.log('🔥 計時秒數:', seconds, '效果:', effect);
            
            // 停止舊計時器
            stopTest();
            
            // 重置解答區
            const explanation = document.getElementById('explanation');
            explanation.classList.remove('timer-hidden', 'timer-dimmed');
            
            // 顯示計時器
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.style.display = 'flex';
            
            let timeLeft = seconds;
            const totalTime = seconds;
            
            // 獲取元素
            const timerNumber = document.getElementById('timer-number');
            const timerCircle = document.getElementById('timer-circle');
            
            // 更新顯示函數
            function updateTimer() {
                console.log('🔥 剩餘時間:', timeLeft);
                
                // 更新數字
                timerNumber.textContent = timeLeft;
                
                // 更新進度條
                const circumference = 2 * Math.PI * 42; // 264
                const progress = (totalTime - timeLeft) / totalTime;
                const strokeDashoffset = circumference * (1 - progress);
                timerCircle.style.strokeDashoffset = strokeDashoffset;
                
                console.log('🔥 進度:', progress, 'strokeDashoffset:', strokeDashoffset);
                
                // 更新顏色
                timerDisplay.className = 'timer-display';
                if (timeLeft <= 3) {
                    timerDisplay.classList.add('timer-critical');
                    timerCircle.style.stroke = '#f44336';
                } else if (timeLeft <= 5) {
                    timerDisplay.classList.add('timer-warning');
                    timerCircle.style.stroke = '#ff9800';
                } else {
                    timerCircle.style.stroke = '#ff6b6b';
                }
            }
            
            // 初始更新
            updateTimer();
            
            // 開始倒數
            testTimer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft < 0) {  // 🔥 改為 < 0，讓它顯示到 0
                    clearInterval(testTimer);
                    testTimer = null;
                    onTimerExpired(effect);
                }
            }, 1000);
        }

        function stopTest() {
            console.log('🔥 停止計時器');
            
            if (testTimer) {
                clearInterval(testTimer);
                testTimer = null;
            }
            
            // 隱藏計時器
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.style.display = 'none';
            
            // 重置解答區
            const explanation = document.getElementById('explanation');
            explanation.classList.remove('timer-hidden', 'timer-dimmed');
        }

        function onTimerExpired(effect) {
            console.log('🔥 計時器到期！效果:', effect);
            
            // 🔥 不隱藏計時器，讓它保留在 0 的狀態
            // const timerDisplay = document.getElementById('timer-display');
            // timerDisplay.style.display = 'none';
            
            // 應用效果到解答區
            const explanation = document.getElementById('explanation');
            if (effect === 'hide') {
                explanation.classList.add('timer-hidden');
                console.log('🔥 已隱藏解答');
            } else if (effect === 'dim') {
                explanation.classList.add('timer-dimmed');
                console.log('🔥 已變淡解答');
            }
        }
    </script>
</body>
</html>