<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¨ˆæ™‚å™¨æ¸¬è©¦</title>
    <style>
        /* è¨ˆæ™‚å™¨æ¨£å¼ */
        .timer-display {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
            z-index: 10;
        }

        .timer-circle {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 2;
        }

        .timer-number {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b6b;
            line-height: 1;
        }

        .timer-label {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }

        .timer-ring {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotate(-90deg);
            z-index: 1;
        }

        .timer-ring circle {
            stroke-dasharray: 264;
            stroke-dashoffset: 264;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
            fill: none;
            stroke-width: 6;
            stroke: #ff6b6b;
        }

        .timer-warning .timer-number {
            color: #ff9800;
            animation: timerPulse 1s infinite;
        }

        .timer-critical .timer-number {
            color: #f44336;
            animation: timerPulse 0.5s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* è§£ç­”å€æ¨£å¼ */
        .explanation {
            background: #f0f0f0;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
        }

        .explanation.timer-hidden {
            display: none !important;
        }

        .explanation.timer-dimmed {
            opacity: 0.3 !important;
            filter: blur(1px) !important;
            pointer-events: none !important;
            background-color: #f0f0f0 !important;
            color: #999 !important;
            transition: all 0.3s ease !important;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>è¨ˆæ™‚å™¨æ¸¬è©¦</h1>
    
    <div>
        <label>è¨ˆæ™‚ç§’æ•¸ï¼š</label>
        <input type="number" id="timer-input" value="5" min="1" max="60">
        <button onclick="startTest()">é–‹å§‹æ¸¬è©¦</button>
        <button onclick="stopTest()">åœæ­¢æ¸¬è©¦</button>
    </div>

    <!-- è¨ˆæ™‚å™¨é¡¯ç¤º -->
    <div id="timer-display" class="timer-display" style="display: none;">
        <div class="timer-circle">
            <div class="timer-text">
                <div class="timer-number" id="timer-number">5</div>
                <div class="timer-label">ç§’</div>
            </div>
            <svg class="timer-ring" width="100" height="100">
                <circle id="timer-circle" cx="50" cy="50" r="42" stroke="#ff6b6b" stroke-width="6" fill="none" />
            </svg>
        </div>
    </div>

    <!-- æ¸¬è©¦è§£ç­”å€ -->
    <div id="explanation" class="explanation">
        é€™æ˜¯æ¸¬è©¦è§£ç­”å€åŸŸã€‚æ™‚é–“åˆ°å¾Œï¼Œé€™è£¡æ‡‰è©²æœƒéš±è—æˆ–è®Šæ·¡ã€‚
    </div>

    <div>
        <label>æ•ˆæœé¡å‹ï¼š</label>
        <select id="effect-type">
            <option value="hide">éš±è—è§£ç­”</option>
            <option value="dim">è§£ç­”è®Šæ·¡</option>
        </select>
    </div>

    <script>
        let testTimer = null;

        function startTest() {
            console.log('ğŸ”¥ é–‹å§‹æ¸¬è©¦è¨ˆæ™‚å™¨');
            
            // ç²å–è¨­å®š
            const seconds = parseInt(document.getElementById('timer-input').value) || 5;
            const effect = document.getElementById('effect-type').value;
            
            console.log('ğŸ”¥ è¨ˆæ™‚ç§’æ•¸:', seconds, 'æ•ˆæœ:', effect);
            
            // åœæ­¢èˆŠè¨ˆæ™‚å™¨
            stopTest();
            
            // é‡ç½®è§£ç­”å€
            const explanation = document.getElementById('explanation');
            explanation.classList.remove('timer-hidden', 'timer-dimmed');
            
            // é¡¯ç¤ºè¨ˆæ™‚å™¨
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.style.display = 'flex';
            
            let timeLeft = seconds;
            const totalTime = seconds;
            
            // ç²å–å…ƒç´ 
            const timerNumber = document.getElementById('timer-number');
            const timerCircle = document.getElementById('timer-circle');
            
            // æ›´æ–°é¡¯ç¤ºå‡½æ•¸
            function updateTimer() {
                console.log('ğŸ”¥ å‰©é¤˜æ™‚é–“:', timeLeft);
                
                // æ›´æ–°æ•¸å­—
                timerNumber.textContent = timeLeft;
                
                // æ›´æ–°é€²åº¦æ¢
                const circumference = 2 * Math.PI * 42; // 264
                const progress = (totalTime - timeLeft) / totalTime;
                const strokeDashoffset = circumference * (1 - progress);
                timerCircle.style.strokeDashoffset = strokeDashoffset;
                
                console.log('ğŸ”¥ é€²åº¦:', progress, 'strokeDashoffset:', strokeDashoffset);
                
                // æ›´æ–°é¡è‰²
                timerDisplay.className = 'timer-display';
                if (timeLeft <= 3) {
                    timerDisplay.classList.add('timer-critical');
                    timerCircle.style.stroke = '#f44336';
                } else if (timeLeft <= 5) {
                    timerDisplay.classList.add('timer-warning');
                    timerCircle.style.stroke = '#ff9800';
                } else {
                    timerCircle.style.stroke = '#ff6b6b';
                }
            }
            
            // åˆå§‹æ›´æ–°
            updateTimer();
            
            // é–‹å§‹å€’æ•¸
            testTimer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft < 0) {  // ğŸ”¥ æ”¹ç‚º < 0ï¼Œè®“å®ƒé¡¯ç¤ºåˆ° 0
                    clearInterval(testTimer);
                    testTimer = null;
                    onTimerExpired(effect);
                }
            }, 1000);
        }

        function stopTest() {
            console.log('ğŸ”¥ åœæ­¢è¨ˆæ™‚å™¨');
            
            if (testTimer) {
                clearInterval(testTimer);
                testTimer = null;
            }
            
            // éš±è—è¨ˆæ™‚å™¨
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.style.display = 'none';
            
            // é‡ç½®è§£ç­”å€
            const explanation = document.getElementById('explanation');
            explanation.classList.remove('timer-hidden', 'timer-dimmed');
        }

        function onTimerExpired(effect) {
            console.log('ğŸ”¥ è¨ˆæ™‚å™¨åˆ°æœŸï¼æ•ˆæœ:', effect);
            
            // ğŸ”¥ ä¸éš±è—è¨ˆæ™‚å™¨ï¼Œè®“å®ƒä¿ç•™åœ¨ 0 çš„ç‹€æ…‹
            // const timerDisplay = document.getElementById('timer-display');
            // timerDisplay.style.display = 'none';
            
            // æ‡‰ç”¨æ•ˆæœåˆ°è§£ç­”å€
            const explanation = document.getElementById('explanation');
            if (effect === 'hide') {
                explanation.classList.add('timer-hidden');
                console.log('ğŸ”¥ å·²éš±è—è§£ç­”');
            } else if (effect === 'dim') {
                explanation.classList.add('timer-dimmed');
                console.log('ğŸ”¥ å·²è®Šæ·¡è§£ç­”');
            }
        }
    </script>
</body>
</html>